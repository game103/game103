var detailOriginalWidth,detailOriginalHeight,detailResponsive=!0,detailCurValue=1,detailMouseDown=0;function detailChangeZoom(e){var t=document.getElementById("movie"),i=document.getElementById("enable-flash"),a=document.getElementById("preview-box");null==e&&(e=document.getElementById("zoom-slider").value/100),detailSetSizeFromMovieSize(t,detailCurValue=e),i&&detailSetSizeFromMovieSize(i,e),a.style.display="none",t.style.visibility="visible",i&&(i.style.visibility="visible");var n=calculateDimensions();detailResponsive?(t.offsetWidth+575>n.width||i&&i.offsetWidth+575>n.width)&&(detailStripResponsiveClasses(),detailResponsive=!1):(t.offsetWidth&&t.offsetWidth+575<=n.width||i&&i.offsetWidth&&i.offsetWidth+575<=n.width)&&(detailAddResponsiveClasses(),detailResponsive=!0)}function detailPreview(){if(detailMouseDown){document.getElementById("movie");detailSetSizeFromMovieSize(document.getElementById("preview-box"),document.getElementById("zoom-slider").value/100)}}function detailHideGame(){var e=document.getElementById("movie"),t=document.getElementById("enable-flash");document.getElementById("preview-box").style.display="block",e.style.visibility="hidden",t&&(t.style.visibility="hidden")}function detailEnsureValue(){detailMouseDown?detailPreview():document.getElementById("zoom-slider").value=100*detailCurValue}function detailStripResponsiveClasses(){for(var e=Array.prototype.slice.call(document.getElementsByClassName("responsive"),0),t=0;t<e.length;t++)e[t].classList.remove("responsive"),e[t].classList.add("was-responsive")}function detailAddResponsiveClasses(){for(var e=Array.prototype.slice.call(document.getElementsByClassName("was-responsive"),0),t=0;t<e.length;t++)e[t].classList.add("responsive"),e[t].classList.remove("was-responsive")}function detailShrink(){document.getElementById("movie");.5<detailCurValue-.25?detailCurValue-=.25:detailCurValue=.5,detailChangeZoom(detailCurValue),detailEnsureValue()}function detailGrow(){document.getElementById("movie");detailCurValue+.25<1.75?detailCurValue+=.25:detailCurValue=1.75,detailChangeZoom(detailCurValue),detailEnsureValue()}function detailFullscreen(){document.getElementById("movie");var e=document.getElementsByClassName("header")[0].offsetHeight+79,t=calculateDimensions(),i=t.height,a=t.width,n=i/detailOriginalHeight,l=(a-10)/detailOriginalWidth;l<n&&(n=l),detailChangeZoom(n),window.scrollTo(document.getElementById("movie-container").offsetLeft-5,e),detailEnsureValue()}function detailDefault(){document.getElementById("movie");detailChangeZoom(1),detailEnsureValue()}function calculateDimensions(){var e=document.createElement("div");e.style.position="fixed",e.style.width="1px",e.style.height="1px",e.style.bottom="0",e.style.right="0",e.style.visibility="hidden",document.getElementsByClassName("page")[0].appendChild(e);var t={height:e.offsetTop+1};return e.style.position="absolute",t.width=e.offsetLeft+1,e.parentNode.removeChild(e),t}function detailSetSizeFromMovieSize(e,t){e.style.width=(detailOriginalWidth*t).toString().concat("px"),e.style.height=(detailOriginalHeight*t).toString().concat("px")}function detailSetTotalStars(e,t){var i=document.getElementById(t);i.innerHTML="",e=parseFloat(e);var a=22*Math.max(0,Math.min(5,e)),n=document.createElement("span");n.style.width=a.toString().concat("px"),i.appendChild(n)}function detailRate(i,e,t){if(!(isNaN(Number(i))||Number(i)<0||5<Number(i))){var a=document.getElementById("show-rating-normal"),n=document.getElementById("show-rating-loading");n.style.display="block",a.style.display="none";var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==l.readyState&&200==l.status)try{var e=JSON.parse(l.responseText),t=e.status;"failure"!=t||e.your_rating?(document.getElementsByClassName("detail-your-rating")[0].innerHTML="<span class='detail-stars' id='your-stars'></span>",n.style.display="none",a.style.display="inline","failure"==t?(detailSetTotalStars(e.your_rating,"your-stars"),document.getElementsByClassName("detail-thanks-for-voting")[0].innerHTML=e.message):(detailSetTotalStars(i,"your-stars"),detailSetTotalStars(e.rating,"total-stars"),voteStr=" vote",1!=e.votes&&(voteStr=" votes"),document.getElementsByClassName("detail-total-votes")[0].innerHTML=e.votes+voteStr),document.getElementsByClassName("detail-thanks-for-voting")[0].style.display="block"):n.innerHTML=e.message}catch(e){console.log(e),n.innerHTML="Sorry, an error occured while trying to process your vote. Please try again later."}},l.open("GET","/ws/rating.php?id="+t+"&rating="+i+"&type="+e,!0),l.send()}}function checkFlashEnabled(){var e=document.getElementById("enable-flash"),t=document.getElementById("movie");if(e){var i=!1;try{i=Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){i=void 0!==navigator.mimeTypes["application/x-shockwave-flash"]}if(!i){t.style.display="none",t.parentNode.style.overflowY="auto",e.style.display="table";var a=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,n=-1<navigator.userAgent.toLowerCase().indexOf("android");return void(a?(e.querySelector("#enable-flash-message-default").style.display="none",e.querySelector("#enable-flash-message-ios").style.display="block"):n&&(e.querySelector("#enable-flash-message-default").style.display="none",e.querySelector("#enable-flash-message-android").style.display="block"))}}}function setHTML5(){setCookie("html5",1),window.location.reload()}function disableHTML5(){deleteCookie("html5"),window.location.reload()}function toggleHTML5(){document.querySelector("#html5").innerText.match("Flash")?disableHTML5():setHTML5()}document.addEventListener("DOMContentLoaded",function(){try{document.body.onmousedown=function(){++detailMouseDown},document.body.onmouseup=function(){--detailMouseDown};var e=window.location.pathname.split("/");if("download"==e[1])return;logInteraction(e[1],e[2]),"range"!=document.getElementById("zoom-slider").type&&(document.getElementById("zoom-slider").style.display="none",document.getElementById("full").style.display="none",document.getElementById("default").style.display="none",document.getElementById("shrink").style.display="inline-block",document.getElementById("grow").style.display="inline-block");var t=document.getElementById("movie");detailOriginalWidth=parseInt(t.style.width),detailOriginalHeight=parseInt(t.style.height);var i=document.getElementById("zoom-slider");i.onmousedown=detailHideGame,i.onmouseup=function(){detailChangeZoom()},i.onchange=detailEnsureValue,i.oninput=detailPreview,window.addEventListener("resize",function(){detailChangeZoom(),detailEnsureValue()}),document.getElementById("full").onclick=detailFullscreen,document.getElementById("default").onclick=detailDefault,document.getElementById("shrink").onclick=detailShrink,document.getElementById("grow").onclick=detailGrow,document.getElementById("html5").onclick=toggleHTML5;for(var a=document.querySelectorAll(".detail-star"),n=0;n<a.length;n++)a[n].onclick=function(){detailRate(this.getAttribute("data-value"),e[1],this.parentNode.getAttribute("data-id"))};checkFlashEnabled();var l=new XMLHttpRequest,o=document.querySelector(".detail-similar-items-placeholder");l.onreadystatechange=function(){if(4==l.readyState)try{var e=JSON.parse(l.responseText);o.innerHTML=e.content}catch(e){}},l.open("GET","/ws/load_similar.php?type="+e[1]+"&id="+o.getAttribute("data-id"),!0),l.send();var s=new XMLHttpRequest,d=document.querySelector(".detail-others-also-played-placeholder");d&&(s.onreadystatechange=function(){if(4==s.readyState)try{var e=JSON.parse(s.responseText);d.innerHTML=e.content}catch(e){}},s.open("GET","/ws/load_others_also_played.php?id="+o.getAttribute("data-id"),!0),s.send()),detailChangeZoom(),detailEnsureValue();var r=document.head,u=document.createElement("style");r.appendChild(u),u.type="text/css",u.appendChild(document.createTextNode(".detail-left-side-box.responsive{float:left;}.detail-right-side-box.responsive{float:right;}.detail-side-boxes.responsive{display:inline;background-color:transparent;}.detail-side-box.responsive{/*Thismarginreplacesthemarginthatwasonside-boxesbeforeside-boxesbecameinline*/margin-top:10px;display:inline-block;}.detail-side-box-item.responsive{margin-bottom:10px;display:block;}.detail-separator.responsive{display:none;}"))}catch(e){}},!1);